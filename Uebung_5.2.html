<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Übung 5.2</title>
</head>
<body>
    <h1>Rednerliste</h1>
    <label for="fname">Neuer Redner: </label>
    <input type="text" id="neuerRedner">
    <button id="hinzbutton">Hinzufügen</button>
    <ul id="Rednerliste"></ul>
</body>

<script>
    const Rednerliste = document.getElementById("Rednerliste");
    const button = document.getElementById("hinzbutton");   
    let aktiverRedner = null;
    button.addEventListener("click", function(){
        const neuerRedner = document.getElementById('neuerRedner').value;
        const neuezeile = document.createElement('li');

        if(aktiverRedner != null){  // Wenn es schon einen aktiven Redner gibt, dann schalte seinen Timer aus und setze den Button von Stopp! auf Start!
            clearInterval(aktiverRedner.timerId);
            aktiverRedner.querySelector("button").textContent = "Start!";
        }
        
        const rednerObjekt = {
            name: neuerRedner,
            start: new Date().getTime(),
            element: neuezeile,
            button: null,
            sekunden:0,
            minuten:0,
            stunden:0
        };
        aktiverRedner = neuezeile;

        const startstoppButton = document.createElement('button');
        startstoppButton.textContent = 'Stopp!';

        let timer = document.createElement('text');
        timer.textContent = ' 00:00:00s ';

        neuezeile.textContent = neuerRedner;
        neuezeile.appendChild(timer)    // füge den timer dem Listenelement hinzu
        startstoppButton.addEventListener("click", event => startstopp(timer, rednerObjekt)); // WICHTIG (um den Zugriff auf ein älteres Listenelement nicht zu verlieren. Alternative und komplexer:Array)
        neuezeile.appendChild(startstoppButton);    // füge den Button dem Listenelement hinzu
        
        Rednerliste.appendChild(neuezeile); // füge die Zeile in die Liste hinzu

        aktiverRedner.timerId= setInterval(aktualisiereZeit, 1000); // damit speichern wir die timerId mit der wir den Timer stoppen können
        function aktualisiereZeit() {
            ++rednerObjekt.sekunden;
            if (rednerObjekt.sekunden === 60) {
                    rednerObjekt.sekunden = 0;
                    rednerObjekt.minuten++;
                    if (rednerObjekt.minuten === 60) {
                        rednerObjekt.minuten = 0;
                        rednerObjekt.stunden++;
                    }
                }
                timer.textContent = " " + NullDavor(rednerObjekt.stunden) + ":" + NullDavor(rednerObjekt.minuten) + ":" + NullDavor(rednerObjekt.sekunden) + 's';
        }

        

        function startstopp(timer, rednerObjekt){   // der startstoppbutton ist immer der button der gedrückt wurde
            if(aktiverRedner == rednerObjekt.element) { // wenn der aktive Redner den startstoppbutton (hier im Zustand Stopp!) gedrückt hat (aktiverRedner == neuezeile kann nur der aktuelle Redner sein) 
                aktiverRedner.querySelector("button").textContent = "Start!";
                clearInterval(aktiverRedner.timerId);
             }else{  // Ansonsten hat irgendjemand anderes Start gedrückt!
                // dann müssen wir auch den Button von dem neuesten Redner auf Start! stellen
                aktiverRedner.querySelector("button").textContent = "Start!";   // Setze den Button vom neuesten Redner auf Start!
                clearInterval(aktiverRedner.timerId);       // pausiere auch seinen Timer
                // und den startstoppbutton der angeklickt wurde auf Stopp! stellen
                aktiverRedner = rednerObjekt.element;
                startstoppButton.textContent = " Stopp! ";  // den button von dem der jetzt gedrückt wurde auf Stopp! stellen (also jemand hat auf Start! gedrückt)

                aktiverRedner.timerId = setInterval(function(){
                    ++rednerObjekt.sekunden;
                    if (rednerObjekt.sekunden === 60) {
                        rednerObjekt.sekunden = 0;
                        rednerObjekt.minuten++;
                        if (rednerObjekt.minuten === 60) {
                            rednerObjekt.minuten = 0;
                            rednerObjekt.stunden++;
                        }
                    }
                    timer.textContent = " " + NullDavor(rednerObjekt.stunden) + ":" + NullDavor(rednerObjekt.minuten) + ":" + NullDavor(rednerObjekt.sekunden) + 's';
                },1000);
            }
        }

        function NullDavor(zeit) {
        return zeit < 10 ? "0" + zeit : zeit;
    }
    })
</script>
</html>
